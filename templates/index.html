{% extends "base.html" %}

{% block content %}
<div class="page-header">
    <h2>Nuevo An√°lisis de Supervivencia</h2>
    <p>Sube tus datos financieros y obt√©n una proyecci√≥n de caja fiable con recomendaciones accionables</p>
</div>

<form action="{{ url_for('analyze') }}" method="post" enctype="multipart/form-data" class="analysis-form">
    
    <!-- Section 1: B√°sico (Required) -->
    <div class="form-section">
        <h3>üìä Informaci√≥n B√°sica <span class="required">*Obligatorio</span></h3>
        
        <div class="form-group">
            <label for="starting_balance">Saldo Actual Disponible (‚Ç¨) *</label>
            <input type="number" step="0.01" name="starting_balance" id="starting_balance" required 
                   placeholder="ej. 15000.00">
            <small>Tu saldo en banco disponible hoy</small>
        </div>

        <div class="form-group">
            <label for="horizon_months">Horizonte de Supervivencia *</label>
            <select name="horizon_months" id="horizon_months" required>
                <option value="3">3 meses</option>
                <option value="6" selected>6 meses (recomendado)</option>
                <option value="9">9 meses</option>
                <option value="12">12 meses</option>
            </select>
            <small>¬øCu√°ntos meses quieres proyectar?</small>
        </div>

        <div class="form-group">
            <label for="bank_file">Extracto Bancario (CSV o Excel) *</label>
            <input type="file" name="bank_file" id="bank_file" accept=".csv,.xlsx,.xls" required>
            <small>Movimientos bancarios hist√≥ricos. <a href="{{ url_for('help_page') }}#templates" target="_blank">Ver formato</a></small>
        </div>
    </div>

    <!-- Section 2: Datos Adicionales (Optional) -->
    <div class="form-section">
        <h3>üìà Datos Adicionales (Opcionales pero recomendados)</h3>
        
        <div class="form-group">
            <label for="fixed_costs_monthly">Gastos Fijos Mensuales (‚Ç¨)</label>
            <input type="number" step="0.01" name="fixed_costs_monthly" id="fixed_costs_monthly" 
                   placeholder="ej. 5000.00">
            <small>N√≥minas, alquiler, suscripciones fijas, etc.</small>
        </div>

        <div class="form-group">
            <label for="sales_invoices_file">Facturas Emitidas (CSV o Excel)</label>
            <input type="file" name="sales_invoices_file" id="sales_invoices_file" accept=".csv,.xlsx,.xls">
            <small>Facturas pendientes de cobro. <a href="{{ url_for('help_page') }}#templates" target="_blank">Ver formato</a></small>
        </div>

        <div class="form-group">
            <label for="purchase_invoices_file">Facturas Recibidas (CSV o Excel)</label>
            <input type="file" name="purchase_invoices_file" id="purchase_invoices_file" accept=".csv,.xlsx,.xls">
            <small>Facturas pendientes de pago. <a href="{{ url_for('help_page') }}#templates" target="_blank">Ver formato</a></small>
        </div>
    </div>

    <!-- Section 3: L√≠nea de Cr√©dito -->
    <div class="form-section">
        <h3>üí≥ L√≠nea de Cr√©dito (Opcional)</h3>
        
        <div class="form-row">
            <div class="form-group">
                <label for="credit_line_total">L√≠nea de Cr√©dito Total (‚Ç¨)</label>
                <input type="number" step="0.01" name="credit_line_total" id="credit_line_total" 
                       placeholder="ej. 50000.00">
            </div>

            <div class="form-group">
                <label for="credit_line_used">Cr√©dito Usado Actualmente (‚Ç¨)</label>
                <input type="number" step="0.01" name="credit_line_used" id="credit_line_used" 
                       placeholder="ej. 10000.00">
            </div>
        </div>

        <div class="form-group">
            <label for="interest_rate">Inter√©s Anual Estimado (%)</label>
            <input type="number" step="0.01" name="interest_rate" id="interest_rate" 
                   placeholder="ej. 5.5">
            <small>Para estimar coste de uso de cr√©dito</small>
        </div>
    </div>

    <!-- Section 4: Configuraci√≥n Avanzada -->
    <div class="form-section">
        <h3>‚öôÔ∏è Configuraci√≥n Avanzada</h3>
        
        <div class="form-group">
            <label for="safety_threshold">Umbral de Seguridad (‚Ç¨)</label>
            <input type="number" step="0.01" name="safety_threshold" id="safety_threshold" 
                   placeholder="ej. 5000.00">
            <small>Saldo m√≠nimo que quieres mantener como colch√≥n</small>
        </div>

        <div class="form-group">
            <label for="granularity">Granularidad de An√°lisis</label>
            <select name="granularity" id="granularity">
                <option value="daily">Diaria</option>
                <option value="weekly" selected>Semanal (recomendado)</option>
                <option value="monthly">Mensual</option>
            </select>
            <small>Nivel de detalle de la proyecci√≥n</small>
        </div>

        <div class="form-group checkbox-group">
            <label>
                <input type="checkbox" name="conservative_mode" id="conservative_mode">
                <strong>Modo Conservador</strong>
            </label>
            <small>Retrasar cobros previstos +15 d√≠as en escenario conservador</small>
        </div>
    </div>

    <!-- Submit -->
    <div class="form-actions">
        <button type="submit" class="btn btn-primary">
            üöÄ Analizar Supervivencia Financiera
        </button>
        <p class="form-note">El an√°lisis tarda 10-30 segundos. Los datos se procesan localmente.</p>
    </div>
</form>

<div class="info-box">
    <h4>üí° ¬øQu√© obtendr√°s?</h4>
    <ul>
        <li>‚úÖ Proyecci√≥n de caja fiable (c√°lculo determinista, no IA)</li>
        <li>‚úÖ Capital necesario para sobrevivir X meses</li>
        <li>‚úÖ Financiaci√≥n puente vs capital propio</li>
        <li>‚úÖ Suficiencia de tu l√≠nea de cr√©dito</li>
        <li>‚úÖ Escenarios "qu√© pasa si..."</li>
        <li>‚úÖ Alertas accionables + plan de acci√≥n priorizado</li>
        <li>‚úÖ Informe descargable (TXT, MD, CSV)</li>
        <li>‚úÖ Memoria persistente (reabre y compara an√°lisis)</li>
    </ul>
</div>

{% endblock %}
