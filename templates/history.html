{% extends "base.html" %}

{% block title %}Historial - Copiloto de Supervivencia{% endblock %}

{% block content %}
<div class="history-page">
    <div class="page-header">
        <h2>üìö Historial de An√°lisis</h2>
        <p>Todos tus an√°lisis guardados. Haz clic para reabrir cualquiera.</p>
    </div>

    {% if snapshots %}
    <div class="table-container">
        <table class="history-table">
            <thead>
                <tr>
                    <th>Fecha</th>
                    <th>Confianza</th>
                    <th>Cobertura</th>
                    <th>Riesgo</th>
                    <th>Saldo M√≠n.</th>
                    <th>Capital Necesario</th>
                    <th>Brecha</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for snapshot in snapshots %}
                <tr>
                    <td>{{ snapshot.created_at[:16].replace('T', ' ') }}</td>
                    <td>
                        <span class="badge confidence-{{ snapshot.confidence_level }}">
                            {{ snapshot.confidence_level | upper }}
                        </span>
                    </td>
                    <td>{{ "%.1f" | format(snapshot.coverage_months) }}m</td>
                    <td>
                        <span class="badge risk-{{ snapshot.risk_level }}">
                            {{ snapshot.risk_level | upper }}
                        </span>
                    </td>
                    <td class="{% if snapshot.min_balance < 0 %}negative{% endif %}">
                        {{ "%.0f" | format(snapshot.min_balance) }}‚Ç¨
                    </td>
                    <td>{{ "%.0f" | format(snapshot.capital_needed) }}‚Ç¨</td>
                    <td class="{% if snapshot.credit_gap > 0 %}negative{% endif %}">
                        {{ "%.0f" | format(snapshot.credit_gap) }}‚Ç¨
                    </td>
                    <td>
                        <div style="display: flex; gap: 0.5rem;">
                            <a href="{{ url_for('results', snapshot_id=snapshot.snapshot_id) }}" 
                               class="btn btn-small" title="Ver an√°lisis">üëÅÔ∏è Ver</a>
                            <form method="POST" action="{{ url_for('delete_analysis', snapshot_id=snapshot.snapshot_id) }}" 
                                  style="display: inline;"
                                  onsubmit="return confirm('¬øSeguro que quieres eliminar este an√°lisis? Esta acci√≥n no se puede deshacer.');">
                                <button type="submit" class="btn btn-small btn-danger" title="Eliminar">üóëÔ∏è</button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <p>üì≠ No hay an√°lisis guardados todav√≠a.</p>
        <a href="{{ url_for('index') }}" class="btn btn-primary">Crear Primer An√°lisis</a>
    </div>
    {% endif %}
</div>
{% endblock %}
